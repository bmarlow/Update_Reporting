#jinja2: trim_blocks: "true", lstrip_blocks: "true", keep_trailing_newline: "true"
{% set major_version = ansible_distribution_major_version | int %}

{# Takes a string formatted like nginx-1:1.18.0-1.fc32.noarch #}
{# Will render like such: nginx : 1.16.0-1.fc32.noarch ==> 1.18.0-1.fc32.noarch #}
{# {{- old.split(':')[0].split('-')[:-1] | join('-') }}: {{ old.split(':')[1] }} ==> {{ new.split(':')[1] }} #}

{# If using RHEL 8 you get a pretty table of information #}
{% if ansible_distribution == "RedHat" and major_version >= 8 | int %}

  <table cellspacing="1" border="1" bordercolor="#000000">
    <TR>
      <TH colspan="3" align="left">Update Process Started: {{ s_datetime.stdout.split('T')[0] }} {{ s_datetime.stdout.split('T')[1][:-1] }}</TH>
    </TR>
    <TR>
      <TH colspan="3" align="left">Update Process Finished: {{ e_datetime.stdout.split('T')[0] }} {{ e_datetime.stdout.split('T')[1][:-1] }}</TH>
    </TR>
    <TR>
      <TH colspan="3" align="left">Duration: {{ duration }}</TH>
    <TR>
    </TR>
      <TH> Package </TH>
      <TH> Previous Version </TH>
      <TH> New Version </TH>
    </TR>
  {% for old in old_packages | sort %}
  	{% for new in new_packages | sort %}
  		{% if old.split(':')[0] == new.split(':')[0] %}
  			<TR>
  			  <TD> {{- old.split(':')[0].split('-')[:-1] | join('-') }} </TD>
  			  <TD> {{ old.split(':')[1] }} </TD>
  			  <TD> {{ new.split(':')[1] }} </TD>
  			</TR>
  		{% endif %}
  	{% endfor %}
  {% endfor %}
  </table>

{# If using another OS/version we will just print out the data returned from the update module #}
{# This is because each version/package manager structures return data a little differently #}
{% else %}
  Update Process Started: {{ s_datetime.stdout.split('T')[0] }} {{ s_datetime.stdout.split('T')[1][:-1] }}<br>
  Update Process Finished: {{ e_datetime.stdout.split('T')[0] }} {{ e_datetime.stdout.split('T')[1][:-1] }}<br>
  Duration: {{ duration }}<br>
  *****************************************<br>
  {% for result in update_details.results %}
    {% for line in result.splitlines() %}
      {{ line }}<br>
    {% endfor %}
  {% endfor %}
{% endif %}